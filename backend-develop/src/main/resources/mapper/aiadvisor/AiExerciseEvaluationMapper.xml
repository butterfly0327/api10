<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yumyumcoach.domain.aiadvisor.mapper.AiExerciseEvaluationMapper">

    <resultMap id="ExerciseEvaluationResult" type="com.yumyumcoach.domain.aiadvisor.entity.AiExerciseEvaluation">
        <id column="id" property="id" />
        <result column="email" property="email" />
        <result column="reference_date" property="referenceDate" />
        <result column="week_start_date" property="weekStartDate" />
        <result column="week_end_date" property="weekEndDate" />
        <result column="volume_status" property="volumeStatus" />
        <result column="recommendation" property="recommendation" />
        <result column="model_used" property="modelUsed" />
        <result column="created_at" property="createdAt" />
    </resultMap>

    <select id="selectByEmailAndReferenceDate" parameterType="map" resultMap="ExerciseEvaluationResult">
        SELECT *
        FROM ai_exercise_evaluations
        WHERE email = #{email}
          AND reference_date = #{referenceDate}
        LIMIT 1
    </select>

    <insert id="insert" parameterType="map" useGeneratedKeys="true" keyProperty="evaluation.id">
        INSERT INTO ai_exercise_evaluations (
            email, reference_date, week_start_date, week_end_date,
            volume_status, recommendation, model_used, created_at
        ) VALUES (
            #{evaluation.email}, #{evaluation.referenceDate}, #{evaluation.weekStartDate}, #{evaluation.weekEndDate},
            #{evaluation.volumeStatus}, #{evaluation.recommendation}, #{evaluation.modelUsed}, #{evaluation.createdAt}
        )
    </insert>
</mapper>
